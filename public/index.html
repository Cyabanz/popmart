<!DOCTYPE html>
<html>
<body>
<button id="start">Start Session</button>
<iframe id="iframe" style="width:100%;height:500px;"></iframe>

<script>
async function getCsrf() {
  await fetch('/api/csrf'); // sets CSRF cookie
}
async function startSession() {
  const resp = await fetch('/api/start-session', {
    method: 'POST',
    headers: {
      'X-CSRF-Token': getCsrfTokenFromCookies()
    }
  });
  const data = await resp.json();
  if (data.embedUrl) {
    document.getElementById('iframe').src = data.embedUrl;
    alert('Session started!');
  } else {
    alert(data.error || 'Something went wrong!');
  }
}
function getCsrfTokenFromCookies() {
  return document.cookie.split('; ')
    .find(c => c.startsWith('csrf_token='))
    ?.split('=')[1];
}
getCsrf();
document.getElementById('start').addEventListener('click', startSession);
</script>
</body>
</html>
