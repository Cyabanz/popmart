<!DOCTYPE html>
<html>
<body>
<button id="start">Start Session</button>
<iframe id="iframe" style="width:100%;height:500px;"></iframe>

<script>
let csrfToken;

async function getCsrf() {
  const resp = await fetch('/api/csrf');
  const data = await resp.json();
  csrfToken = data.token;
}

async function startSession() {
  if (!csrfToken) {
    alert('Missing CSRF token, trying again...');
    await getCsrf();
  }
  const resp = await fetch('/api/start-session', {
    method: 'POST',
    headers: {
      'X-CSRF-Token': csrfToken
    }
  });
  const data = await resp.json();
  if (data.embedUrl) {
    document.getElementById('iframe').src = data.embedUrl;
    alert('Session started!');
  } else {
    alert(data.error || 'Something went wrong!');
  }
}

// Get CSRF token on page load
getCsrf();

document.getElementById('start').addEventListener('click', startSession);
</script>
</body>
</html>
